
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Task Executor &#8212; BlazingSQL v0.18 documentation</title>
    
  <link href="../_static/css/theme.css" rel="stylesheet" />
  <link href="../_static/css/index.4eb26a98c046fa117c2b75e31c15adbb.css" rel="stylesheet" />

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      
  <link rel="stylesheet"
    href="../_static/vendor/open-sans_all/1.44.1/index.css">
  <link rel="stylesheet"
    href="../_static/vendor/lato_latin-ext/1.44.1/index.css">

    
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/basic.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/css/getting_started.css" />
    <link rel="stylesheet" type="text/css" href="../_static/css/blazingsql.css" />
    <link rel="stylesheet" type="text/css" href="../_static/css/theme.css" />
    <link rel="stylesheet" type="text/css" href="../_static/css/pandas.css" />
    <link rel="stylesheet" type="text/css" href="../_static/collapsible-lists/css/tree_view.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.3edd59071b60732de7f5.js">

    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/language_data.js"></script>
    <script src="../_static/js/d3.v3.min.js"></script>
    <script src="../_static/collapsible-lists/js/CollapsibleLists.compressed.js"></script>
    <script src="../_static/collapsible-lists/js/apply-collapsible-lists.js"></script>
    <link rel="shortcut icon" href="../_static/blazingsql-icon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <nav class="navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main">
<div class="container-xl">

    <a class="navbar-brand" href="../index.html">
    
      <img src="../_static/blazingNotebooks_logo.png" class="logo" alt="logo" />
    
    </a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-menu" aria-controls="navbar-menu" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
    </button>
    
    <div id="navbar-menu" class="col-lg-9 collapse navbar-collapse">
      <ul id="navbar-main-elements" class="navbar-nav mr-auto">
        
        
        
      </ul>


      

      <ul class="navbar-nav">
        
        
      </ul>
    </div>
</div>
    </nav>
    

    <div class="container-xl">
      <div class="row">
          
            
            <!-- Only show if we have sidebars configured, else just a small margin  -->
            <div class="col-12 col-md-3 bd-sidebar"><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form>
<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">

    <div class="bd-toc-item active">
    
  
    <ul class="nav bd-sidenav">
        
      </ul>
  
  </nav>
            </div>
            
          

          
          <div class="d-none d-xl-block col-xl-2 bd-toc">
              
<div class="tocsection onthispage pt-5 pb-3">
    <i class="fas fa-list"></i> On this page
</div>

<nav id="bd-toc-nav">
    <ul class="nav section-nav flex-column">
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#tasks" class="nav-link">Tasks</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#resource-management" class="nav-link">Resource Management</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#task-queue" class="nav-link">Task Queue</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#task-retry" class="nav-link">Task Retry</a>
        </li>
    
    </ul>
</nav>



<div class="tocsection editthispage">
    <a href="https://github.com/blazingdb/blazingsql/edit/feedback/docsrc/source/arch/executor.rst">
        <i class="fas fa-pencil-alt"></i> Edit this page
    </a>
</div>

              
          </div>
          

          
          
            
          
          <main class="col-12 col-md-9 col-xl-7 py-md-5 pl-md-5 pr-md-4 bd-content" role="main">
              
              <div>
                
  <div class="section" id="task-executor">
<h1>Task Executor<a class="headerlink" href="#task-executor" title="Permalink to this headline">¶</a></h1>
<p>The task executor manages a queue of tasks to be run. These are the tasks that are created by the different kernels.
The task executor’s job is to take all of the jobs in the queue and actually schedule them to run on the hardware that we are targetting.
Currently we only target Nvidia GPUs with our executor.</p>
<div class="section" id="tasks">
<h2>Tasks<a class="headerlink" href="#tasks" title="Permalink to this headline">¶</a></h2>
<p>A task consists of a set of input CacheDatas, a pointer to a kernel, a pointer to an output cache and map of key and value optional arguments.
When the executor runs a task, it will first decahe the input CacheDatas, to materialize the input data into BlazingTables and then run the
kernel’s <code class="docutils literal notranslate"><span class="pre">do_process()</span></code> function on that input data.</p>
</div>
<div class="section" id="resource-management">
<h2>Resource Management<a class="headerlink" href="#resource-management" title="Permalink to this headline">¶</a></h2>
<p>The task executor tries to ensure that when it schedules tasks to run, that it does not run out of resources. There are two configuration options that
control how many concurrent tasks can be executred:
- <em>EXECUTOR_THREADS</em>: This sets a hard maximum number of concurrent tasks that can be executed
- <em>BLAZING_PROCESSING_DEVICE_MEM_CONSUMPTION_THRESHOLD</em>: This is a percent of the total GPU memory that the executor will try to stay under for starting new tasks.</p>
<p>Before every task it will compare how much GPU memory the task will need, plus the memory already being used and compare that against this threshold.
If the task will take it over the threshold, it will not start the task. The exception to that is that if there are no tasks running, then it will always try to run a task.
The memory estimation for how much a task will need is the sum of the estimate of how much decacheing the inputs will need, plus an estimate of the size of the outputs, plut an estimate
of the memory overhead needed for that algorithm. The kernel interface requires to implement the functions necessary for these memory consumption estimates.</p>
</div>
<div class="section" id="task-queue">
<h2>Task Queue<a class="headerlink" href="#task-queue" title="Permalink to this headline">¶</a></h2>
<p>Right now there is no priority for tasks and tasks are just processed FIFO. This is an obvious current weakness and should be improved upon when time permits.</p>
</div>
<div class="section" id="task-retry">
<h2>Task Retry<a class="headerlink" href="#task-retry" title="Permalink to this headline">¶</a></h2>
<p>If a task runs into a OOM error when executing a task, the executor will attempt to re-create the task with the same inputs and add it back to the queue. There are two places
where the task executor could detect an OOM error. The first is during the decacheing of the task’s input CacheDatas. If an OOM happens during decacheing, it will try to recreate
the task using that CacheData it was trying to decache, and then add that task back to the task executor’s queue. The second is inside the <code class="docutils literal notranslate"><span class="pre">do_process()</span></code> function of the kernel.
In the <code class="docutils literal notranslate"><span class="pre">do_process()</span></code> function, there should always be a try/catch block. If an OOM is caught, then it will try to take the input BlazingTables and output them
with an error flag, so that the BlazingTables can be placed back into a CacheData and the task can be re-created. In either case, there can be circumstances where
the input data cannot be recovered, and therefore the task cannot be recreated. One of those cases is when a task modifies the input data in place. In such a case,
the <code class="docutils literal notranslate"><span class="pre">do_process()</span></code> function would return with an error flag that indicates that it should not be retried. If a task cannot be recreated,
then the query will be terminated with an error.</p>
</div>
</div>


              </div>
              
              
              <div class='prev-next-bottom'>
                

              </div>
              
          </main>
          

      </div>
    </div>

    
  <script src="../_static/js/index.3edd59071b60732de7f5.js"></script>


    <footer class="footer mt-5 mt-md-0">
  <div class="container">
    <p>
          &copy; Copyright 2020, BlazingDB, Inc..<br/>
        Created using <a href="http://sphinx-doc.org/">Sphinx</a> 3.3.1.<br/>
    </p>
  </div>
</footer>
  </body>
</html>