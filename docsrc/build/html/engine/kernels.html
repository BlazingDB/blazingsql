
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Kernels &#8212; BlazingSQL v0.18 documentation</title>
    
  <link href="../_static/css/theme.css" rel="stylesheet" />
  <link href="../_static/css/index.4eb26a98c046fa117c2b75e31c15adbb.css" rel="stylesheet" />

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      
  <link rel="stylesheet"
    href="../_static/vendor/open-sans_all/1.44.1/index.css">
  <link rel="stylesheet"
    href="../_static/vendor/lato_latin-ext/1.44.1/index.css">

    
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/basic.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/css/getting_started.css" />
    <link rel="stylesheet" type="text/css" href="../_static/css/blazingsql.css" />
    <link rel="stylesheet" type="text/css" href="../_static/css/theme.css" />
    <link rel="stylesheet" type="text/css" href="../_static/css/pandas.css" />
    <link rel="stylesheet" type="text/css" href="../_static/bootstrap-treeview/bootstrap-treeview.min.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.3edd59071b60732de7f5.js">

    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/language_data.js"></script>
    <script src="../_static/js/d3.v3.min.js"></script>
    <script src="../_static/bootstrap-treeview/bootstrap-treeview.min.js"></script>
    <link rel="shortcut icon" href="../_static/blazingsql-icon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Memory Management" href="memory_management.html" />
    <link rel="prev" title="I/O" href="io.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <nav class="navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main">
<div class="container-xl">

    <a class="navbar-brand" href="../index.html">
    
      <img src="../_static/blazingNotebooks_logo.png" class="logo" alt="logo" />
    
    </a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-menu" aria-controls="navbar-menu" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
    </button>
    
    <div id="navbar-menu" class="col-lg-9 collapse navbar-collapse">
      <ul id="navbar-main-elements" class="navbar-nav mr-auto">
        
        
        <li class="nav-item ">
            <a class="nav-link" href="../getting_started/index.html">Getting started</a>
        </li>
        
        <li class="nav-item active">
            <a class="nav-link" href="index.html">Engine</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="../xml/library_root.html">Library API</a>
        </li>
        
        
      </ul>


      

      <ul class="navbar-nav">
        
        
      </ul>
    </div>
</div>
    </nav>
    

    <div class="container-xl">
      <div class="row">
          
            
            <!-- Only show if we have sidebars configured, else just a small margin  -->
            <div class="col-12 col-md-3 bd-sidebar"><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form>
<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">

    <div class="bd-toc-item active">
    
  
    <ul class="nav bd-sidenav">
        
        
        
        
          
            
                <li class="">
                    <a href="arch.html">Technology Stack</a>
                </li>
            
          
            
                <li class="">
                    <a href="caches.html">Caches</a>
                </li>
            
          
            
                <li class="">
                    <a href="communication.html">Communication</a>
                </li>
            
          
            
                <li class="">
                    <a href="data_structures.html">Data Structures</a>
                </li>
            
          
            
                <li class="">
                    <a href="executor.html">Task Executor</a>
                </li>
            
          
            
                <li class="">
                    <a href="graph.html">Overview</a>
                </li>
            
          
            
                <li class="">
                    <a href="interops.html">Interops</a>
                </li>
            
          
            
                <li class="">
                    <a href="io.html">I/O</a>
                </li>
            
          
            
                <li class="active">
                    <a href="">Kernels</a>
                </li>
            
          
            
                <li class="">
                    <a href="memory_management.html">Memory Management</a>
                </li>
            
          
            
                <li class="">
                    <a href="relational_algebra.html">Relational algebra</a>
                </li>
            
          
        
        
        
        
      </ul>
  
  </nav>
            </div>
            
          

          
          <div class="d-none d-xl-block col-xl-2 bd-toc">
              
<div class="tocsection onthispage pt-5 pb-3">
    <i class="fas fa-list"></i> On this page
</div>

<nav id="bd-toc-nav">
    <ul class="nav section-nav flex-column">
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#base-kernel" class="nav-link">Base Kernel</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#non-distributing-kernels" class="nav-link">Non Distributing Kernels</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#distributing-kernels" class="nav-link">Distributing kernels</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#implementing-a-basic-kernel" class="nav-link">Implementing a Basic Kernel</a><ul class="nav section-nav flex-column">
                
        <li class="nav-item toc-entry toc-h3">
            <a href="#constructor" class="nav-link">Constructor</a>
        </li>
    
        <li class="nav-item toc-entry toc-h3">
            <a href="#run-function" class="nav-link">Run Function</a>
        </li>
    
        <li class="nav-item toc-entry toc-h3">
            <a href="#do-process-function" class="nav-link">do_process Function</a>
        </li>
    
        <li class="nav-item toc-entry toc-h3">
            <a href="#estimation-functions" class="nav-link">Estimation Functions</a>
        </li>
    
            </ul>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#implementing-a-distributed-kernel" class="nav-link">Implementing a Distributed Kernel</a><ul class="nav section-nav flex-column">
                
        <li class="nav-item toc-entry toc-h3">
            <a href="#id1" class="nav-link">do_process Function</a>
        </li>
    
            </ul>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#limitations-of-current-approach" class="nav-link">Limitations of Current Approach</a>
        </li>
    
    </ul>
</nav>



<div class="tocsection editthispage">
    <a href="https://github.com/blazingdb/blazingsql/edit/feedback/docsrc/source/engine/kernels.rst">
        <i class="fas fa-pencil-alt"></i> Edit this page
    </a>
</div>

              
          </div>
          

          
          
            
          
          <main class="col-12 col-md-9 col-xl-7 py-md-5 pl-md-5 pr-md-4 bd-content" role="main">
              
              <div>
                
  <div class="section" id="kernels">
<h1>Kernels<a class="headerlink" href="#kernels" title="Permalink to this headline">Â¶</a></h1>
<p>Every step in the physical plan maps to exactly one kernel. Kernels Organize logically the transformations that are going to be performed on a distributed dataframe.</p>
<p>They operate in parallel both to other kernels on the same node, and to its counterpart on other nodes.
Some kernels are able to operate on every partition of data as it comes. As in the case of something like a Project or ComputeAggregate kernel.
Some of them have to wait for certain conditions to be met like the MergeAggregate or the SortAndSampleKernel.
Put together kernels can be used to string together scalable, distributed, and resource exhaustion tolerant transformations on data.</p>
<p>Complex Logical operations are broken down into smaller parts. An aggregation is actually comprised of three kernels for example.
One that performs distributed reductions (ComputeAggregateKernel) another that performs the scattering of certain partitions of the
reduced data to other nodes (PartitionKernel), and one that combines those multiple reductions (MergeAggregateKernel).</p>
<div class="section" id="base-kernel">
<h2>Base Kernel<a class="headerlink" href="#base-kernel" title="Permalink to this headline">Â¶</a></h2>
<p>The Kernel base class, <a class="reference external" href="https://github.com/BlazingDB/blazingsql/blob/branch-0.19//engine/src/execution_graph/logic_controllers/taskflow/kernel.h">found here</a>,
provides many of the functionalities which are common to all Kernels.</p>
<p>For example: All kernels have an input port and an output port. Each of which
contains a map of named CacheMachines. A kernel might write to multiple outputs
and may receive input from multiple inputs but they are all contained within
the input and output ports.</p>
<p>Only in the TableScan and BindableTableScan kernels are the input ports not defined.
In these two cases the kernels themselves generate data either by passing
through a cudf or by reading files.</p>
<p>The base kernel also provides mechanisms for tracking the state of tasks which were dispatched by the kernel to the executor.</p>
</div>
<div class="section" id="non-distributing-kernels">
<h2>Non Distributing Kernels<a class="headerlink" href="#non-distributing-kernels" title="Permalink to this headline">Â¶</a></h2>
<ul class="simple">
<li><p><a class="reference external" href="api/classral_1_1batch_1_1BindableTableScan.html">BindableTableScan</a></p></li>
<li><p><a class="reference external" href="api/classral_1_1batch_1_1ComputeAggregateKernel.html">ComputeAggregateKernel</a></p></li>
<li><p><a class="reference external" href="api/classral_1_1batch_1_1ComputeAggregateKernel.html">ComputeWindowKernel</a></p></li>
<li><p><a class="reference external" href="api/classral_1_1batch_1_1Filter.html">Filter</a></p></li>
<li><p><a class="reference external" href="api/classral_1_1batch_1_1MergeAggregateKernel.html">MergeAggregateKernel</a></p></li>
<li><p><a class="reference external" href="api/classral_1_1batch_1_1MergeStreamKernel.html">MergeStreamKernel</a></p></li>
<li><p><a class="reference external" href="api/classral_1_1batch_1_1OutputKernel.html">OutputKernel</a></p></li>
<li><p><a class="reference external" href="api/classral_1_1batch_1_1PartitionSingleNodeKernel.html">PartitionSingleNodeKernel</a></p></li>
<li><p><a class="reference external" href="api/classral_1_1batch_1_1PartwiseJoin.html">PartwiseJoin</a></p></li>
<li><p><a class="reference external" href="api/classral_1_1batch_1_1PartitionSingleNodeKernel.html">Print</a></p></li>
<li><p><a class="reference external" href="api/classral_1_1batch_1_1Projection.html">Projection</a></p></li>
<li><p><a class="reference external" href="api/classral_1_1batch_1_1TableScan.html">TableScan</a></p></li>
<li><p><a class="reference external" href="api/classral_1_1batch_1_1UnionKernel.html">UnionKernel</a></p></li>
</ul>
</div>
<div class="section" id="distributing-kernels">
<h2>Distributing kernels<a class="headerlink" href="#distributing-kernels" title="Permalink to this headline">Â¶</a></h2>
<p>Kernels that distribute information between different nodes have a series of helper functions that it allow it to push dataframes or portions of dataframes to other nodes. It has no expectations about how those messages will be distributed and all it does is push these dataframes into a cache with routing information.</p>
<ul class="simple">
<li><p><a class="reference external" href="api/classral_1_1batch_1_1DistributeAggregateKernel.html">DistributeAggregateKernel</a></p></li>
<li><p><a class="reference external" href="api/classral_1_1batch_1_1JoinPartitionKernel.html">JoinPartitionKernel</a></p></li>
<li><p><a class="reference external" href="api/classral_1_1batch_1_1LimitKernel.html">LimitKernel</a></p></li>
<li><p><a class="reference external" href="api/classral_1_1batch_1_1PartitionKernel.html">PartitionKernel</a></p></li>
<li><p><a class="reference external" href="api/classral_1_1batch_1_1SortAndSampleKernel.html">SortAndSampleKernel</a></p></li>
</ul>
</div>
<div class="section" id="implementing-a-basic-kernel">
<h2>Implementing a Basic Kernel<a class="headerlink" href="#implementing-a-basic-kernel" title="Permalink to this headline">Â¶</a></h2>
<p>A Kernel has two functions that must be implemented for it to be operational. A <a class="reference external" href="api/classral_1_1cache_1_1kernel.html#classral_1_1cache_1_1kernel_1a735b081cccae9574924e74ea6d293ef7">run()</a> function that takes no parameters and a <a class="reference external" href="api/classral_1_1cache_1_1kernel.html#classral_1_1cache_1_1kernel_1aa8d19c5f112f8965ea2f9999fb5fd625">do_process()</a> function. Below we are going to go over an example of a simple kernel and how these two functions are implemented.</p>
<p>In addition to this there are other functions that if implemented will allow the engine to be more judicious in how it schedules work. Examples of this are things like estimate_output_bytes() and estimate_operating_bytes() lets the engine be able to estimate how much memory it will need for either storing the output or will need as temporary space to perform this kernels operation on a specified input.</p>
<div class="section" id="constructor">
<h3>Constructor<a class="headerlink" href="#constructor" title="Permalink to this headline">Â¶</a></h3>
<p>The constructors for kernels are usually trivial to implement. The parameter queryString is the relational algebra snippet, in this case the predicate,
which is currently being evaluated. In the contructor we also usually perform any pre-processing to the queryString as necessary to obtain any parameters we
use in the kernel.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">Filter</span><span class="o">::</span><span class="n">Filter</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="kt">size_t</span> <span class="n">kernel_id</span><span class="p">,</span>
 <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="o">&amp;</span> <span class="n">queryString</span><span class="p">,</span>
 <span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Context</span><span class="o">&gt;</span> <span class="n">context</span><span class="p">,</span>
 <span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">ral</span><span class="o">::</span><span class="n">cache</span><span class="o">::</span><span class="n">graph</span><span class="o">&gt;</span> <span class="n">query_graph</span><span class="p">)</span>
<span class="o">:</span> <span class="n">kernel</span><span class="p">(</span><span class="n">kernel_id</span><span class="p">,</span> <span class="n">queryString</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="n">kernel_type</span><span class="o">::</span><span class="n">FilterKernel</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">this</span><span class="o">-&gt;</span><span class="n">query_graph</span> <span class="o">=</span> <span class="n">query_graph</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="run-function">
<h3>Run Function<a class="headerlink" href="#run-function" title="Permalink to this headline">Â¶</a></h3>
<p>Most run functions are implemented relatively trivially. In general they pull one or more CacheData inputs from an input CacheMachine and use them to create a task
along with the output cache destination, and the kernel itself as parameters. For other kernels, the run function will need to wait until certain messages are
received from other nodes or other conditions before tasks are created. But ultimatelly the purpose of the run function is to handle the
orchestration and business logic necessary for creating execution tasks.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">kstatus</span> <span class="n">Filter</span><span class="o">::</span><span class="n">run</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">CodeTimer</span> <span class="n">timer</span><span class="p">;</span>

    <span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span> <span class="o">&lt;</span><span class="n">ral</span><span class="o">::</span><span class="n">cache</span><span class="o">::</span><span class="n">CacheData</span><span class="o">&gt;</span> <span class="n">cache_data</span> <span class="o">=</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">input_cache</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">pullCacheData</span><span class="p">();</span>
    <span class="k">while</span><span class="p">(</span><span class="n">cache_data</span> <span class="o">!=</span> <span class="k">nullptr</span><span class="p">){</span>
        <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span> <span class="o">&lt;</span><span class="n">ral</span><span class="o">::</span><span class="n">cache</span><span class="o">::</span><span class="n">CacheData</span><span class="o">&gt;</span> <span class="o">&gt;</span> <span class="n">inputs</span><span class="p">;</span>
        <span class="n">inputs</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">cache_data</span><span class="p">));</span>

        <span class="n">ral</span><span class="o">::</span><span class="n">execution</span><span class="o">::</span><span class="n">executor</span><span class="o">::</span><span class="n">get_instance</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">add_task</span><span class="p">(</span>
                <span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">inputs</span><span class="p">),</span>
                <span class="k">this</span><span class="o">-&gt;</span><span class="n">output_cache</span><span class="p">(),</span>
                <span class="k">this</span><span class="p">);</span>

        <span class="n">cache_data</span> <span class="o">=</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">input_cache</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">pullCacheData</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="k">if</span><span class="p">(</span><span class="n">logger</span><span class="p">){</span>
        <span class="n">logger</span><span class="o">-&gt;</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;{query_id}|{step}|{substep}|{info}|{duration}|kernel_id|{kernel_id}||&quot;</span><span class="p">,</span>
                                    <span class="s">&quot;query_id&quot;</span><span class="n">_a</span><span class="o">=</span><span class="n">context</span><span class="o">-&gt;</span><span class="n">getContextToken</span><span class="p">(),</span>
                                    <span class="s">&quot;step&quot;</span><span class="n">_a</span><span class="o">=</span><span class="n">context</span><span class="o">-&gt;</span><span class="n">getQueryStep</span><span class="p">(),</span>
                                    <span class="s">&quot;substep&quot;</span><span class="n">_a</span><span class="o">=</span><span class="n">context</span><span class="o">-&gt;</span><span class="n">getQuerySubstep</span><span class="p">(),</span>
                                    <span class="s">&quot;info&quot;</span><span class="n">_a</span><span class="o">=</span><span class="s">&quot;Filter Kernel tasks created&quot;</span><span class="p">,</span>
                                    <span class="s">&quot;duration&quot;</span><span class="n">_a</span><span class="o">=</span><span class="n">timer</span><span class="p">.</span><span class="n">elapsed_time</span><span class="p">(),</span>
                                    <span class="s">&quot;kernel_id&quot;</span><span class="n">_a</span><span class="o">=</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">get_id</span><span class="p">());</span>
    <span class="p">}</span>

    <span class="n">std</span><span class="o">::</span><span class="n">unique_lock</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">mutex</span><span class="o">&gt;</span> <span class="n">lock</span><span class="p">(</span><span class="n">kernel_mutex</span><span class="p">);</span>
    <span class="n">kernel_cv</span><span class="p">.</span><span class="n">wait</span><span class="p">(</span><span class="n">lock</span><span class="p">,[</span><span class="k">this</span><span class="p">]{</span>
        <span class="k">return</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">tasks</span><span class="p">.</span><span class="n">empty</span><span class="p">()</span> <span class="o">||</span> <span class="n">ral</span><span class="o">::</span><span class="n">execution</span><span class="o">::</span><span class="n">executor</span><span class="o">::</span><span class="n">get_instance</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">has_exception</span><span class="p">();</span>
    <span class="p">});</span>

    <span class="k">if</span><span class="p">(</span><span class="k">auto</span> <span class="n">ep</span> <span class="o">=</span> <span class="n">ral</span><span class="o">::</span><span class="n">execution</span><span class="o">::</span><span class="n">executor</span><span class="o">::</span><span class="n">get_instance</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">last_exception</span><span class="p">()){</span>
        <span class="n">std</span><span class="o">::</span><span class="n">rethrow_exception</span><span class="p">(</span><span class="n">ep</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">if</span><span class="p">(</span><span class="n">logger</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">logger</span><span class="o">-&gt;</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;{query_id}|{step}|{substep}|{info}|{duration}|kernel_id|{kernel_id}||&quot;</span><span class="p">,</span>
                                    <span class="s">&quot;query_id&quot;</span><span class="n">_a</span><span class="o">=</span><span class="n">context</span><span class="o">-&gt;</span><span class="n">getContextToken</span><span class="p">(),</span>
                                    <span class="s">&quot;step&quot;</span><span class="n">_a</span><span class="o">=</span><span class="n">context</span><span class="o">-&gt;</span><span class="n">getQueryStep</span><span class="p">(),</span>
                                    <span class="s">&quot;substep&quot;</span><span class="n">_a</span><span class="o">=</span><span class="n">context</span><span class="o">-&gt;</span><span class="n">getQuerySubstep</span><span class="p">(),</span>
                                    <span class="s">&quot;info&quot;</span><span class="n">_a</span><span class="o">=</span><span class="s">&quot;Filter Kernel Completed&quot;</span><span class="p">,</span>
                                    <span class="s">&quot;duration&quot;</span><span class="n">_a</span><span class="o">=</span><span class="n">timer</span><span class="p">.</span><span class="n">elapsed_time</span><span class="p">(),</span>
                                    <span class="s">&quot;kernel_id&quot;</span><span class="n">_a</span><span class="o">=</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">get_id</span><span class="p">());</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">kstatus</span><span class="o">::</span><span class="n">proceed</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="do-process-function">
<h3>do_process Function<a class="headerlink" href="#do-process-function" title="Permalink to this headline">Â¶</a></h3>
<p>The do_process function is what gets run by a task. It is invoked by the <a class="reference internal" href="executor.html"><span class="doc">Task Executor</span></a> after the kernel has submitted a task for execution.</p>
<p>The do_process function also has mechanisms that allow for out of memory error recovery. If in the execution of a do_process function call, there is an OOM error,
the do_process function, when possible, will take the inputs and return them back to the caller (the Task Executor), so that it can recreate the task to try again later.
In the case of a filter kernel we can recover from out of memory errors because the input into this kernel is not modified.
This is the case for almost every kernel. This function always receives an array because some kernels operate on more than one dataframe at a time like Union or PartwiseJoin.
This function returns a struct with a status, an error message, and the inputs to it in case it failed.</p>
<p>Some kernels need to be able to have different types of tasks, or take in different types of inputs. This is handled by the key value args map. The key value args map
can have a parameter âoperation_typeâ which will define which type of task is is.</p>
<p>At some point we need to add a way to be able to have different do_process
functions to be able to target different backends.</p>
<blockquote>
<div><div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">ral</span><span class="o">::</span><span class="n">execution</span><span class="o">::</span><span class="n">task_result</span> <span class="n">Filter</span><span class="o">::</span><span class="n">do_process</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">ral</span><span class="o">::</span><span class="n">frame</span><span class="o">::</span><span class="n">BlazingTable</span><span class="o">&gt;</span> <span class="o">&gt;</span> <span class="n">inputs</span><span class="p">,</span>
        <span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">ral</span><span class="o">::</span><span class="n">cache</span><span class="o">::</span><span class="n">CacheMachine</span><span class="o">&gt;</span> <span class="n">output</span><span class="p">,</span>
        <span class="n">cudaStream_t</span> <span class="cm">/*stream*/</span><span class="p">,</span> <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">map</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;&amp;</span> <span class="cm">/*args*/</span><span class="p">)</span> <span class="p">{</span>

        <span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">ral</span><span class="o">::</span><span class="n">frame</span><span class="o">::</span><span class="n">BlazingTable</span><span class="o">&gt;</span> <span class="n">columns</span><span class="p">;</span>
        <span class="k">try</span><span class="p">{</span>
                <span class="c1">//Get the input we are working on</span>
                <span class="k">auto</span> <span class="o">&amp;</span> <span class="n">input</span> <span class="o">=</span> <span class="n">inputs</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>

                <span class="c1">//Perform manipulations and end up with a Dataframe</span>
                <span class="n">columns</span> <span class="o">=</span> <span class="n">ral</span><span class="o">::</span><span class="n">processor</span><span class="o">::</span><span class="n">process_filter</span><span class="p">(</span><span class="n">input</span><span class="o">-&gt;</span><span class="n">toBlazingTableView</span><span class="p">(),</span> <span class="n">expression</span><span class="p">,</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">context</span><span class="p">.</span><span class="n">get</span><span class="p">());</span>

                <span class="c1">//Write the output of that dataframe to the output cache.</span>
                <span class="n">output</span><span class="o">-&gt;</span><span class="n">addToCache</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">columns</span><span class="p">));</span>
        <span class="p">}</span><span class="k">catch</span><span class="p">(</span><span class="k">const</span> <span class="n">rmm</span><span class="o">::</span><span class="n">bad_alloc</span><span class="o">&amp;</span> <span class="n">e</span><span class="p">){</span>
                <span class="c1">//If we ran out of memory we can retry returning the inputs to the caller</span>
                <span class="k">return</span> <span class="p">{</span><span class="n">ral</span><span class="o">::</span><span class="n">execution</span><span class="o">::</span><span class="n">task_status</span><span class="o">::</span><span class="n">RETRY</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">what</span><span class="p">()),</span> <span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">inputs</span><span class="p">)};</span>
        <span class="p">}</span><span class="k">catch</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">exception</span><span class="o">&amp;</span> <span class="n">e</span><span class="p">){</span>

                <span class="k">return</span> <span class="p">{</span><span class="n">ral</span><span class="o">::</span><span class="n">execution</span><span class="o">::</span><span class="n">task_status</span><span class="o">::</span><span class="n">FAIL</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">what</span><span class="p">()),</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">ral</span><span class="o">::</span><span class="n">frame</span><span class="o">::</span><span class="n">BlazingTable</span><span class="o">&gt;</span> <span class="o">&gt;</span> <span class="p">()};</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="p">{</span><span class="n">ral</span><span class="o">::</span><span class="n">execution</span><span class="o">::</span><span class="n">task_status</span><span class="o">::</span><span class="n">SUCCESS</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">(),</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">ral</span><span class="o">::</span><span class="n">frame</span><span class="o">::</span><span class="n">BlazingTable</span><span class="o">&gt;</span> <span class="o">&gt;</span> <span class="p">()};</span>
<span class="p">}</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="estimation-functions">
<h3>Estimation Functions<a class="headerlink" href="#estimation-functions" title="Permalink to this headline">Â¶</a></h3>
<p>These functions are used so that a kernel can generate an estimates of things like their output size, how much data in total it should process,
an estimate for how much overhead is needed to process a transformation on an input of a given size. Below we show the function used to estimate
the number of output rows it will generate in total during execution. It gets an estimate from its input of how many rows it expects to receive
and then multiples this by how much it has filtered out in the previous executions. If no data has yet to be filtered it returns 0 with an indicator
that the estimate isnât valid yet.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">std</span><span class="o">::</span><span class="n">pair</span><span class="o">&lt;</span><span class="kt">bool</span><span class="p">,</span> <span class="kt">uint64_t</span><span class="o">&gt;</span> <span class="n">Filter</span><span class="o">::</span><span class="n">get_estimated_output_num_rows</span><span class="p">(){</span>
    <span class="n">std</span><span class="o">::</span><span class="n">pair</span><span class="o">&lt;</span><span class="kt">bool</span><span class="p">,</span> <span class="kt">uint64_t</span><span class="o">&gt;</span> <span class="n">total_in</span> <span class="o">=</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">query_graph</span><span class="o">-&gt;</span><span class="n">get_estimated_input_rows_to_kernel</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">kernel_id</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">total_in</span><span class="p">.</span><span class="n">first</span><span class="p">){</span>
        <span class="kt">double</span> <span class="n">out_so_far</span> <span class="o">=</span> <span class="p">(</span><span class="kt">double</span><span class="p">)</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">output_</span><span class="p">.</span><span class="n">total_bytes_added</span><span class="p">();</span>
        <span class="kt">double</span> <span class="n">in_so_far</span> <span class="o">=</span> <span class="p">(</span><span class="kt">double</span><span class="p">)</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">total_input_bytes_processed</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">in_so_far</span> <span class="o">==</span> <span class="mi">0</span><span class="p">){</span>
            <span class="k">return</span> <span class="n">std</span><span class="o">::</span><span class="n">make_pair</span><span class="p">(</span><span class="nb">false</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">return</span> <span class="n">std</span><span class="o">::</span><span class="n">make_pair</span><span class="p">(</span><span class="nb">true</span><span class="p">,</span> <span class="p">(</span><span class="kt">uint64_t</span><span class="p">)(</span> <span class="p">((</span><span class="kt">double</span><span class="p">)</span><span class="n">total_in</span><span class="p">.</span><span class="n">second</span><span class="p">)</span> <span class="o">*</span><span class="n">out_so_far</span><span class="o">/</span><span class="n">in_so_far</span><span class="p">)</span> <span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">std</span><span class="o">::</span><span class="n">make_pair</span><span class="p">(</span><span class="nb">false</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="implementing-a-distributed-kernel">
<h2>Implementing a Distributed Kernel<a class="headerlink" href="#implementing-a-distributed-kernel" title="Permalink to this headline">Â¶</a></h2>
<p>A distributing kernel implements a different interface which is inherited by the base kernel interface. It is implemented in much the same way a basic kernel
is implemented but it has at its disposal certain utility functions.
Here we will go over the JoinPartition kernel and how it leverages some of these utilities for execution.</p>
<div class="section" id="id1">
<h3>do_process Function<a class="headerlink" href="#id1" title="Permalink to this headline">Â¶</a></h3>
<p>Here is an example of a do_process function for a distributed kernel, in this case the JoinPartitionKernel.
It calls distribution kernel primitives like <code class="docutils literal notranslate"><span class="pre">broadcast</span></code> and <code class="docutils literal notranslate"><span class="pre">scatter</span></code> to be able to send information to other nodes.
In particular this is an example of the kinds of logical concerns which can often be seperated from execution concerns.
Here the JoinPartitionKernel has no idea how it can scatter or broadcast information to other nodes but just uses those high level apis to do so.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">ral</span><span class="o">::</span><span class="n">execution</span><span class="o">::</span><span class="n">task_result</span> <span class="n">JoinPartitionKernel</span><span class="o">::</span><span class="n">do_process</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">ral</span><span class="o">::</span><span class="n">frame</span><span class="o">::</span><span class="n">BlazingTable</span><span class="o">&gt;&gt;</span> <span class="n">inputs</span><span class="p">,</span>
    <span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">ral</span><span class="o">::</span><span class="n">cache</span><span class="o">::</span><span class="n">CacheMachine</span><span class="o">&gt;</span> <span class="cm">/*output*/</span><span class="p">,</span>
    <span class="n">cudaStream_t</span> <span class="cm">/*stream*/</span><span class="p">,</span> <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">map</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;&amp;</span> <span class="n">args</span><span class="p">)</span> <span class="p">{</span>
    <span class="kt">bool</span> <span class="n">input_consumed</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
    <span class="k">try</span><span class="p">{</span>
            <span class="k">auto</span><span class="o">&amp;</span> <span class="n">operation_type</span> <span class="o">=</span> <span class="n">args</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="s">&quot;operation_type&quot;</span><span class="p">);</span>
            <span class="k">auto</span> <span class="o">&amp;</span> <span class="n">input</span> <span class="o">=</span> <span class="n">inputs</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">operation_type</span> <span class="o">==</span> <span class="s">&quot;small_table_scatter&quot;</span><span class="p">)</span> <span class="p">{</span>
                    <span class="n">input_consumed</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
                    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">small_output_cache_name</span> <span class="o">=</span> <span class="n">scatter_left_right</span><span class="p">.</span><span class="n">first</span> <span class="o">?</span> <span class="s">&quot;output_a&quot;</span> <span class="o">:</span> <span class="s">&quot;output_b&quot;</span><span class="p">;</span>
                    <span class="kt">int</span> <span class="n">small_table_idx</span> <span class="o">=</span> <span class="n">scatter_left_right</span><span class="p">.</span><span class="n">first</span> <span class="o">?</span> <span class="nl">LEFT_TABLE_IDX</span> <span class="p">:</span> <span class="n">RIGHT_TABLE_IDX</span><span class="p">;</span>

                    <span class="n">broadcast</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">input</span><span class="p">),</span>
                            <span class="k">this</span><span class="o">-&gt;</span><span class="n">output_</span><span class="p">.</span><span class="n">get_cache</span><span class="p">(</span><span class="n">small_output_cache_name</span><span class="p">).</span><span class="n">get</span><span class="p">(),</span>
                            <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="c1">//message_id_prefix</span>
                            <span class="n">small_output_cache_name</span><span class="p">,</span> <span class="c1">//cache_id</span>
                            <span class="n">small_table_idx</span> <span class="c1">//message_tracker_idx</span>
                    <span class="p">);</span>
            <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">operation_type</span> <span class="o">==</span> <span class="s">&quot;hash_partition&quot;</span><span class="p">)</span> <span class="p">{</span>
                    <span class="kt">bool</span> <span class="n">normalize_types</span><span class="p">;</span>
                    <span class="kt">int</span> <span class="n">table_idx</span><span class="p">;</span>
                    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">cache_id</span><span class="p">;</span>
                    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">cudf</span><span class="o">::</span><span class="n">size_type</span><span class="o">&gt;</span> <span class="n">column_indices</span><span class="p">;</span>
                    <span class="k">if</span><span class="p">(</span><span class="n">args</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="s">&quot;side&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s">&quot;left&quot;</span><span class="p">){</span>
                            <span class="n">normalize_types</span> <span class="o">=</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">normalize_left</span><span class="p">;</span>
                            <span class="n">table_idx</span> <span class="o">=</span> <span class="n">LEFT_TABLE_IDX</span><span class="p">;</span>
                            <span class="n">cache_id</span> <span class="o">=</span> <span class="s">&quot;output_a&quot;</span><span class="p">;</span>
                            <span class="n">column_indices</span> <span class="o">=</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">left_column_indices</span><span class="p">;</span>
                    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                            <span class="n">normalize_types</span> <span class="o">=</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">normalize_right</span><span class="p">;</span>
                            <span class="n">table_idx</span> <span class="o">=</span> <span class="n">RIGHT_TABLE_IDX</span><span class="p">;</span>
                            <span class="n">cache_id</span> <span class="o">=</span> <span class="s">&quot;output_b&quot;</span><span class="p">;</span>
                            <span class="n">column_indices</span> <span class="o">=</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">right_column_indices</span><span class="p">;</span>
                    <span class="p">}</span>

                    <span class="k">if</span> <span class="p">(</span><span class="n">normalize_types</span><span class="p">)</span> <span class="p">{</span>
                            <span class="n">ral</span><span class="o">::</span><span class="n">utilities</span><span class="o">::</span><span class="n">normalize_types</span><span class="p">(</span><span class="n">input</span><span class="p">,</span> <span class="n">join_column_common_types</span><span class="p">,</span> <span class="n">column_indices</span><span class="p">);</span>
                    <span class="p">}</span>

                    <span class="k">auto</span> <span class="n">batch_view</span> <span class="o">=</span> <span class="n">input</span><span class="o">-&gt;</span><span class="n">view</span><span class="p">();</span>
                    <span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">cudf</span><span class="o">::</span><span class="n">table</span><span class="o">&gt;</span> <span class="n">hashed_data</span><span class="p">;</span>
                    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">cudf</span><span class="o">::</span><span class="n">table_view</span><span class="o">&gt;</span> <span class="n">partitioned</span><span class="p">;</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">input</span><span class="o">-&gt;</span><span class="n">num_rows</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                            <span class="c1">// When is cross_join. `column_indices` is equal to 0, so we need all `batch` columns to apply cudf::hash_partition correctly</span>
                            <span class="k">if</span> <span class="p">(</span><span class="n">column_indices</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                                    <span class="n">column_indices</span><span class="p">.</span><span class="n">resize</span><span class="p">(</span><span class="n">input</span><span class="o">-&gt;</span><span class="n">num_columns</span><span class="p">());</span>
                                    <span class="n">std</span><span class="o">::</span><span class="n">iota</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">begin</span><span class="p">(</span><span class="n">column_indices</span><span class="p">),</span> <span class="n">std</span><span class="o">::</span><span class="n">end</span><span class="p">(</span><span class="n">column_indices</span><span class="p">),</span> <span class="mi">0</span><span class="p">);</span>
                            <span class="p">}</span>

                            <span class="kt">int</span> <span class="n">num_partitions</span> <span class="o">=</span> <span class="n">context</span><span class="o">-&gt;</span><span class="n">getTotalNodes</span><span class="p">();</span>
                            <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">cudf</span><span class="o">::</span><span class="n">size_type</span><span class="o">&gt;</span> <span class="n">hased_data_offsets</span><span class="p">;</span>
                            <span class="n">std</span><span class="o">::</span><span class="n">tie</span><span class="p">(</span><span class="n">hashed_data</span><span class="p">,</span> <span class="n">hased_data_offsets</span><span class="p">)</span> <span class="o">=</span> <span class="n">cudf</span><span class="o">::</span><span class="n">hash_partition</span><span class="p">(</span><span class="n">batch_view</span><span class="p">,</span> <span class="n">column_indices</span><span class="p">,</span> <span class="n">num_partitions</span><span class="p">);</span>
                            <span class="n">assert</span><span class="p">(</span><span class="n">hased_data_offsets</span><span class="p">.</span><span class="n">begin</span><span class="p">()</span> <span class="o">!=</span> <span class="n">hased_data_offsets</span><span class="p">.</span><span class="n">end</span><span class="p">());</span>

                            <span class="c1">// the offsets returned by hash_partition will always start at 0, which is a value we want to ignore for cudf::split</span>
                            <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">cudf</span><span class="o">::</span><span class="n">size_type</span><span class="o">&gt;</span> <span class="n">split_indexes</span><span class="p">(</span><span class="n">hased_data_offsets</span><span class="p">.</span><span class="n">begin</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">hased_data_offsets</span><span class="p">.</span><span class="n">end</span><span class="p">());</span>
                            <span class="n">partitioned</span> <span class="o">=</span> <span class="n">cudf</span><span class="o">::</span><span class="n">split</span><span class="p">(</span><span class="n">hashed_data</span><span class="o">-&gt;</span><span class="n">view</span><span class="p">(),</span> <span class="n">split_indexes</span><span class="p">);</span>
                    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                            <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">context</span><span class="o">-&gt;</span><span class="n">getTotalNodes</span><span class="p">();</span> <span class="n">i</span><span class="o">++</span><span class="p">){</span>
                                    <span class="n">partitioned</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">batch_view</span><span class="p">);</span>
                            <span class="p">}</span>
                    <span class="p">}</span>

                    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">ral</span><span class="o">::</span><span class="n">frame</span><span class="o">::</span><span class="n">BlazingTableView</span><span class="o">&gt;</span> <span class="n">partitions</span><span class="p">;</span>
                    <span class="k">for</span><span class="p">(</span><span class="k">auto</span> <span class="nl">partition</span> <span class="p">:</span> <span class="n">partitioned</span><span class="p">)</span> <span class="p">{</span>
                            <span class="n">partitions</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">ral</span><span class="o">::</span><span class="n">frame</span><span class="o">::</span><span class="n">BlazingTableView</span><span class="p">(</span><span class="n">partition</span><span class="p">,</span> <span class="n">input</span><span class="o">-&gt;</span><span class="n">names</span><span class="p">()));</span>
                    <span class="p">}</span>

                    <span class="n">scatter</span><span class="p">(</span><span class="n">partitions</span><span class="p">,</span>
                            <span class="k">this</span><span class="o">-&gt;</span><span class="n">output_</span><span class="p">.</span><span class="n">get_cache</span><span class="p">(</span><span class="n">cache_id</span><span class="p">).</span><span class="n">get</span><span class="p">(),</span>
                            <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="c1">//message_id_prefix</span>
                            <span class="n">cache_id</span><span class="p">,</span> <span class="c1">//cache_id</span>
                            <span class="n">table_idx</span>  <span class="c1">//message_tracker_idx</span>
                    <span class="p">);</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span> <span class="c1">// not an option! error</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">logger</span><span class="p">)</span> <span class="p">{</span>
                            <span class="n">logger</span><span class="o">-&gt;</span><span class="n">error</span><span class="p">(</span><span class="s">&quot;{query_id}|{step}|{substep}|{info}|{duration}||||&quot;</span><span class="p">,</span>
                                                                                    <span class="s">&quot;query_id&quot;</span><span class="n">_a</span><span class="o">=</span><span class="n">context</span><span class="o">-&gt;</span><span class="n">getContextToken</span><span class="p">(),</span>
                                                                                    <span class="s">&quot;step&quot;</span><span class="n">_a</span><span class="o">=</span><span class="n">context</span><span class="o">-&gt;</span><span class="n">getQueryStep</span><span class="p">(),</span>
                                                                                    <span class="s">&quot;substep&quot;</span><span class="n">_a</span><span class="o">=</span><span class="n">context</span><span class="o">-&gt;</span><span class="n">getQuerySubstep</span><span class="p">(),</span>
                                                                                    <span class="s">&quot;info&quot;</span><span class="n">_a</span><span class="o">=</span><span class="s">&quot;In JoinPartitionKernel::do_process Invalid operation_type: {}&quot;</span><span class="n">_format</span><span class="p">(</span><span class="n">operation_type</span><span class="p">),</span>
                                                                                    <span class="s">&quot;duration&quot;</span><span class="n">_a</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">);</span>
                    <span class="p">}</span>

                    <span class="k">return</span> <span class="p">{</span><span class="n">ral</span><span class="o">::</span><span class="n">execution</span><span class="o">::</span><span class="n">task_status</span><span class="o">::</span><span class="n">FAIL</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">(</span><span class="s">&quot;In JoinPartitionKernel::do_process Invalid operation_type&quot;</span><span class="p">),</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">ral</span><span class="o">::</span><span class="n">frame</span><span class="o">::</span><span class="n">BlazingTable</span><span class="o">&gt;</span> <span class="o">&gt;</span> <span class="p">()};</span>
            <span class="p">}</span>
    <span class="p">}</span><span class="k">catch</span><span class="p">(</span><span class="k">const</span> <span class="n">rmm</span><span class="o">::</span><span class="n">bad_alloc</span><span class="o">&amp;</span> <span class="n">e</span><span class="p">){</span>
            <span class="k">return</span> <span class="p">{</span><span class="n">ral</span><span class="o">::</span><span class="n">execution</span><span class="o">::</span><span class="n">task_status</span><span class="o">::</span><span class="n">RETRY</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">what</span><span class="p">()),</span> <span class="n">input_consumed</span> <span class="o">?</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">ral</span><span class="o">::</span><span class="n">frame</span><span class="o">::</span><span class="n">BlazingTable</span><span class="o">&gt;</span> <span class="o">&gt;</span> <span class="p">()</span> <span class="o">:</span> <span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">inputs</span><span class="p">)};</span>
    <span class="p">}</span><span class="k">catch</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">exception</span><span class="o">&amp;</span> <span class="n">e</span><span class="p">){</span>
            <span class="k">return</span> <span class="p">{</span><span class="n">ral</span><span class="o">::</span><span class="n">execution</span><span class="o">::</span><span class="n">task_status</span><span class="o">::</span><span class="n">FAIL</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">what</span><span class="p">()),</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">ral</span><span class="o">::</span><span class="n">frame</span><span class="o">::</span><span class="n">BlazingTable</span><span class="o">&gt;</span> <span class="o">&gt;</span> <span class="p">()};</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="p">{</span><span class="n">ral</span><span class="o">::</span><span class="n">execution</span><span class="o">::</span><span class="n">task_status</span><span class="o">::</span><span class="n">SUCCESS</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">(),</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">ral</span><span class="o">::</span><span class="n">frame</span><span class="o">::</span><span class="n">BlazingTable</span><span class="o">&gt;</span> <span class="o">&gt;</span> <span class="p">()};</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="limitations-of-current-approach">
<h2>Limitations of Current Approach<a class="headerlink" href="#limitations-of-current-approach" title="Permalink to this headline">Â¶</a></h2>
<ul class="simple">
<li><p>Kernels need to be able to target different backends</p></li>
<li><p>Many kernels still use strings for transferring plan information</p></li>
</ul>
</div>
</div>


              </div>
              
              
              <div class='prev-next-bottom'>
                
    <a class='left-prev' id="prev-link" href="io.html" title="previous page">I/O</a>
    <a class='right-next' id="next-link" href="memory_management.html" title="next page">Memory Management</a>

              </div>
              
          </main>
          

      </div>
    </div>

    
  <script src="../_static/js/index.3edd59071b60732de7f5.js"></script>


    <footer class="footer mt-5 mt-md-0">
  <div class="container">
    <p>
          &copy; Copyright 2020, BlazingDB, Inc..<br/>
        Created using <a href="http://sphinx-doc.org/">Sphinx</a> 3.3.1.<br/>
    </p>
  </div>
</footer>
  </body>
</html>